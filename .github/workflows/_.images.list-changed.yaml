---
name: List changed images (container)
on:  # yamllint disable-line rule:truthy
  workflow_call:
    inputs:
      pattern:
        description: Glob pattern to match image files
        required: false
        type: string
        default: |
          charts/**/Dockerfile
    outputs:
      containerfiles:
        description: List of changed Containerfiles
        value: ${{ jobs.list-changed.outputs.containerfiles }}

jobs:
  list-changed:
    name: List changed images
    outputs:
      containerfiles: ${{ steps.format-output.outputs.json }}
    permissions:
      contents: read
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2
        with:
          fetch-depth: 10

      - uses: tj-actions/changed-files@c65cd883420fd2eb864698a825fc4162dd94482c # v44.5.7
        id: changed-images
        with:
          files: ${{ inputs.pattern }}
          json: true
      - id: format-output
        run: echo "json=${{ steps.changed-images.outputs.all_changed_files }}" >> "${GITHUB_OUTPUT}"
